{% extends "users/base.html" %}

{% block title %}Add Business - The Blue List{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-6">Add New Business</h2>
        
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
            <!-- Basic Information -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Basic Information</h3>
                
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Business Name</label>
                    <input type="text" name="name" id="name" required
                           class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                
                <div>
                    <label for="website" class="block text-sm font-medium text-gray-700">Website</label>
                    <input type="url" name="website" id="website"
                           class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                    <textarea name="description" id="description" rows="3" required
                              class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                </div>
            </div>

            <!-- Company Relationships -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Company Relationships</h3>
                
                <div>
                    <label for="parent_company" class="block text-sm font-medium text-gray-700">Parent Company</label>
                    <input type="text" name="parent_company" id="parent_company"
                           class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-gray-500">Leave blank if this is an independent company</p>
                </div>
            </div>

            <!-- Services & Products -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Services & Products</h3>
                
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="provides_services" id="provides_services"
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">This company provides services</span>
                    </label>
                    
                    <div id="services_section" class="mt-2">
                        <label class="block text-sm font-medium text-gray-700">Select Services</label>
                        <select name="services" multiple class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            {% for service in services %}
                                <option value="{{ service.id }}">{{ service.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="provides_products" id="provides_products"
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">This company provides products</span>
                    </label>
                    
                    <div id="products_section" class="mt-2">
                        <label class="block text-sm font-medium text-gray-700">Select Products</label>
                        <select name="products" multiple class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            {% for product in products %}
                                <option value="{{ product.id }}">{{ product.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Political Data -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Political Donations</h3>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="conservative_percentage" class="block text-sm font-medium text-gray-700">Conservative Donation %</label>
                        <input type="number" name="conservative_percentage" id="conservative_percentage" 
                               required min="0" max="100" step="0.01"
                               class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="liberal_percentage" class="block text-sm font-medium text-gray-700">Liberal Donation %</label>
                        <input type="number" name="liberal_percentage" id="liberal_percentage" 
                               required min="0" max="100" step="0.01"
                               class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="conservative_total_donations" class="block text-sm font-medium text-gray-700">Conservative Total ($)</label>
                        <input type="number" name="conservative_total_donations" id="conservative_total_donations" 
                               required min="0" step="0.01"
                               class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="liberal_total_donations" class="block text-sm font-medium text-gray-700">Liberal Total ($)</label>
                        <input type="number" name="liberal_total_donations" id="liberal_total_donations" 
                               required min="0" step="0.01"
                               class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" name="trump_donor" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Trump Donor</span>
                        </label>
                    </div>
                    
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" name="america_pac_donor" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">America PAC Donor</span>
                        </label>
                    </div>
                    
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" name="save_america_pac_donor" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Save America PAC Donor</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label for="data_source" class="block text-sm font-medium text-gray-700">Data Source</label>
                    <input type="text" name="data_source" id="data_source" required
                           class="mt-1 block w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-gray-500">Please provide links or references for the donation data</p>
                </div>
            </div>
            
            <div>
                <button type="submit" 
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md
                               shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700
                               focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Submit Business
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle services section visibility
    const providesServicesCheckbox = document.getElementById('provides_services');
    const servicesSection = document.getElementById('services_section');
    
    providesServicesCheckbox.addEventListener('change', function() {
        servicesSection.style.display = this.checked ? 'block' : 'none';
    });
    
    // Initial state
    servicesSection.style.display = providesServicesCheckbox.checked ? 'block' : 'none';
    
    // Handle products section visibility
    const providesProductsCheckbox = document.getElementById('provides_products');
    const productsSection = document.getElementById('products_section');
    
    providesProductsCheckbox.addEventListener('change', function() {
        productsSection.style.display = this.checked ? 'block' : 'none';
    });
    
    // Initial state
    productsSection.style.display = providesProductsCheckbox.checked ? 'block' : 'none';
    
    // Validate percentages sum to 100
    const conservativePercentage = document.getElementById('conservative_percentage');
    const liberalPercentage = document.getElementById('liberal_percentage');
    
    function validatePercentages() {
        const sum = parseFloat(conservativePercentage.value || 0) + parseFloat(liberalPercentage.value || 0);
        if (sum !== 100) {
            alert('Conservative and Liberal percentages must sum to 100%');
            return false;
        }
        return true;
    }
    
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!validatePercentages()) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}